# =============================================================================
# DeepWiki Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# =============================================================================

# -----------------------------------------------------------------------------
# API Keys (Required based on your provider choice)
# -----------------------------------------------------------------------------

# Google Gemini API Key
# Get from: https://makersuite.google.com/app/apikey
# Required for: Google Gemini models and Google AI embeddings
GOOGLE_API_KEY=

# OpenAI API Key
# Get from: https://platform.openai.com/api-keys
# Required for: OpenAI models and OpenAI embeddings
OPENAI_API_KEY=

# OpenRouter API Key
# Get from: https://openrouter.ai/
# Required for: OpenRouter models (access to multiple AI models via single API)
OPENROUTER_API_KEY=

# DeepSeek API Key
# Get from: https://platform.deepseek.com/api_keys
# Required for: DeepSeek models
DEEPSEEK_API_KEY=

# Azure OpenAI Credentials
# Get from: Azure AI Foundry (Azure OpenAI resource)
# Required for: Azure OpenAI chat models and embeddings
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_VERSION=v1
# Opt-in to the new Azure v1 endpoint (no api-version query param)
# Set to true to use base_url "{endpoint}/openai/v1" via the standard OpenAI client
AZURE_OPENAI_USE_V1=false

# Azure AI Foundry Claude (Anthropic) Credentials
# Get from: Azure AI Foundry (Claude model deployment)
# Required for: Azure AI Foundry Claude models (Sonnet 4.5, Haiku 4.5, Opus 4.5)
# Note: Uses Anthropic Messages API, not OpenAI format
AZURE_ANTHROPIC_ENDPOINT=
AZURE_ANTHROPIC_API_KEY=

# -----------------------------------------------------------------------------
# Embedder Configuration
# -----------------------------------------------------------------------------

# Embedder Type: openai, google, ollama, openrouter, or azure
# Default: openai
# - openai: Uses OpenAI embeddings (requires OPENAI_API_KEY)
# - google: Uses Google AI embeddings (requires GOOGLE_API_KEY)
# - ollama: Uses local Ollama embeddings (no API key required)
# - openrouter: Uses OpenRouter embeddings (requires OPENROUTER_API_KEY)
# - azure: Uses Azure OpenAI embeddings (requires AZURE_OPENAI_API_KEY, AZURE_OPENAI_ENDPOINT, AZURE_OPENAI_VERSION)
DEEPWIKI_EMBEDDER_TYPE=azure

# OpenAI Embedding Model (when DEEPWIKI_EMBEDDER_TYPE=openai)
# Default: text-embedding-3-large
OPENAI_EMBEDDING_MODEL=text-embedding-3-large

# Google Embedding Model (when DEEPWIKI_EMBEDDER_TYPE=google)
# Default: text-embedding-004
GOOGLE_EMBEDDING_MODEL=text-embedding-004

# Ollama Embedding Model (when DEEPWIKI_EMBEDDER_TYPE=ollama)
# Default: nomic-embed-text
OLLAMA_EMBEDDING_MODEL=nomic-embed-text

# OpenRouter Embedding Model (when DEEPWIKI_EMBEDDER_TYPE=openrouter)
# Default: openai/text-embedding-3-small
# Other options: openai/text-embedding-3-large, google/gemini-embedding-001, etc.
OPENROUTER_EMBEDDING_MODEL=openai/text-embedding-3-small

# Azure Embedding Model (when DEEPWIKI_EMBEDDER_TYPE=azure)
# Use your deployment name; default points to text-embedding-3-large
AZURE_OPENAI_EMBEDDING_MODEL=text-embedding-3-large

# Syntax-Aware Code Chunking
# Enable syntax-aware chunking that respects code boundaries for C#, TypeScript, and JavaScript
# Default: false
# - true: Uses tree-sitter to parse code and split by functions, classes, methods, etc.
# - false: Uses standard word-based text splitting
# Note: After enabling, regenerate embeddings for existing repositories to benefit from syntax-aware chunks
USE_SYNTAX_AWARE_CHUNKING=true

# -----------------------------------------------------------------------------
# Worker Concurrency Configuration (Optional)
# -----------------------------------------------------------------------------

# Page Generation Concurrency
# Number of pages to generate in parallel within a single wiki job
# Default: 1 (sequential processing, original behavior)
# Recommended: 2-3 for faster generation with controlled API usage
# Note: Higher values = faster generation but more API rate limit pressure and memory usage
# Set to 1 if you encounter rate limit errors or want to minimize resource usage
DEEPWIKI_PAGE_CONCURRENCY=1

# -----------------------------------------------------------------------------
# API Base URL Configuration
# -----------------------------------------------------------------------------

# OpenAI API Base URL (Optional)
# For custom OpenAI-compatible API endpoints
# Can also be used as universal alias for OpenRouter/DeepSeek
# Example: https://api.openai.com/v1 (default)
OPENAI_BASE_URL=

# OpenRouter API Base URL (Optional)
# For custom OpenRouter API endpoints
# Falls back to OPENAI_BASE_URL if not set
# Default: https://openrouter.ai/api/v1
OPENROUTER_BASE_URL=

# DeepSeek API Base URL (Optional)
# For custom DeepSeek API endpoints or special endpoints
# Falls back to OPENAI_BASE_URL if not set
# Default: https://api.deepseek.com
DEEPSEEK_BASE_URL=

# Ollama Host URL
# Default: http://localhost:11434
# Change this if Ollama is running on a different host or port
OLLAMA_HOST=http://localhost:11434

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# API Server Port
# Default: 8001
PORT=8001

# Server Base URL for Frontend-Backend Communication
# Default: http://localhost:8001
# Note: If you change PORT, update this URL accordingly
SERVER_BASE_URL=http://localhost:8001
NEXT_PUBLIC_SERVER_BASE_URL=http://localhost:8001

# Node Environment
# Options: development, production
# Default: production
NODE_ENV=production

# -----------------------------------------------------------------------------
# Authentication Configuration (Optional)
# -----------------------------------------------------------------------------

# Enable Authorization Mode
# Set to 'true' or '1' to require authorization code for wiki generation
# Default: false
DEEPWIKI_AUTH_MODE=false

# Authorization Code (Required if DEEPWIKI_AUTH_MODE is enabled)
# The secret code required for wiki generation when auth mode is enabled
DEEPWIKI_AUTH_CODE=

# -----------------------------------------------------------------------------
# API Key Authentication (Optional)
# -----------------------------------------------------------------------------

# Enable API key authentication
# Set to 'true' or '1' to require X-API-Key header for all API requests
# Default: false
# Note: This is different from DEEPWIKI_AUTH_MODE (wiki generation auth)
DEEPWIKI_API_KEY_AUTH_ENABLED=false

# Backend API Keys (comma-separated UUIDs)
# Generate: python -c "import uuid; print(uuid.uuid4())"
# Example: 550e8400-e29b-41d4-a716-446655440000,6ba7b810-9dad-11d1-80b4-00c04fd430c8
# Required if DEEPWIKI_API_KEY_AUTH_ENABLED=true
DEEPWIKI_BACKEND_API_KEYS=

# Frontend API Key (for Next.js server-side)
# Should match one key in DEEPWIKI_BACKEND_API_KEYS
# Required if DEEPWIKI_API_KEY_AUTH_ENABLED=true
DEEPWIKI_FRONTEND_API_KEY=

NEXT_PUBLIC_DEEPWIKI_FRONTEND_API_KEY=

# Allowed CORS Origins (comma-separated)
# Default: http://localhost:3000
# Production: https://deepwiki.example.com,https://api.deepwiki.example.com
DEEPWIKI_ALLOWED_ORIGINS=http://localhost:3000

# -----------------------------------------------------------------------------
# User Store Authentication (JSON-based login)
# -----------------------------------------------------------------------------

# Require login using JSON user store (admin/readonly roles)
# Default: false (no login enforced)
DEEPWIKI_AUTH_LOGIN_REQUIRED=false

# Path to JSON user store (mount or bind in Docker)
# Default: api/config/users.json
DEEPWIKI_AUTH_STORE_PATH=api/config/users.json

# JWT secret used to sign login tokens (required when login is enabled)
DEEPWIKI_AUTH_JWT_SECRET=

# JWT expiration time in seconds (default: 3600 = 1 hour)
DEEPWIKI_AUTH_JWT_EXPIRES=3600

# -----------------------------------------------------------------------------
# Configuration Directory (Optional)
# -----------------------------------------------------------------------------

# Custom Configuration Directory
# Path to custom configuration files (generator.json, embedder.json, etc.)
# Default: api/config/
# Example: /path/to/custom/config/dir
DEEPWIKI_CONFIG_DIR=

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

# Log Level
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
LOG_LEVEL=INFO

# Log File Path
# Must be inside api/logs/ directory for security
# Default: api/logs/application.log
LOG_FILE_PATH=api/logs/application.log

# Maximum Log File Size (in MB)
# Default: 10
LOG_MAX_SIZE=10

# Number of Backup Log Files to Keep
# Default: 5
LOG_BACKUP_COUNT=5

# =============================================================================
# Notes:
# =============================================================================
# 1. At minimum, you need one of: GOOGLE_API_KEY, OPENAI_API_KEY, OPENROUTER_API_KEY, DEEPSEEK_API_KEY, or OLLAMA setup
# 2. If using DEEPWIKI_EMBEDDER_TYPE=openai, OPENAI_API_KEY is required
# 3. If using DEEPWIKI_EMBEDDER_TYPE=google, GOOGLE_API_KEY is required
# 4. If using DEEPWIKI_EMBEDDER_TYPE=ollama, no API key is required (local processing)
# 5. If using DEEPWIKI_EMBEDDER_TYPE=openrouter, OPENROUTER_API_KEY is required
# 6. Other API keys are only required when using models from those providers
# 7. For Docker users: Mount this file as .env in the container
# =============================================================================
